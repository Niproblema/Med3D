<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="../lib/three-math.min.js"></script>

<script src="../src/webgl-debug.js"></script>
<script src="../src/Med3D.js"></script>
<script src="../src/loaders/Cache.js"></script>
<script src="../src/loaders/LoadingManager.js"></script>
<script src="../src/loaders/XHRLoader.js"></script>
<script src="../src/GLHelperNew/shaders/ShaderTemplates.js"></script>
<script src="../src/GLHelperNew/shaders/ShaderLoader.js"></script>
<script src="../src/GLHelperNew/GLPrograms.js"></script>
<script src="../src/GLHelperNew/GLManager.js"></script>

<canvas width="1600" height="900" id="canvas"></canvas>

<script>
    // Create new glManager
    var glManager = new M3D.GLManager(document.getElementById("canvas"), M3D.WEBGL1);
    var gl = glManager.context;

    if (gl) {
        // Set clear color to black, fully opaque
        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        // Clear everything
        gl.clearDepth(1);
        // Enable depth testing
        gl.enable(gl.DEPTH_TEST);
        // Near things obscure far things
        gl.depthFunc(gl.LEQUAL);

        var shaderLoader = new M3D.ShaderLoader();

        var shaderLoader = new M3D.ShaderLoader();

        // Cross origin
        shaderLoader.setFullUrl('../src/GLHelperNew/shaders/source/');

        shaderLoader.loadProgramsSources([M3D.GL1_PROGRAM_BASIC], shadersLoaded);
    }
    else {
        throw 'Could not retrieve GL context';
    }

    function shadersLoaded (noErrors) {

        if (!noErrors) {
            throw "Errors occurred during the shader loading.";
        }

        var glProgram = glManager.fetchProgram(M3D.GL1_SHADER_VERTEX_BASIC, M3D.GL1_SHADER_FRAGMENT_BASIC);
        gl.useProgram(glProgram);

        // Set viewport to canvas size
        gl.viewport(0, 0, 1600, 900);

        // Clear the canvas before we start drawing on it.
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        var atrSetter = glProgram.attributesSetter;
        var uniformSetter = glProgram.uniformSetter;

        var squareBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, squareBuffer);
        var vertices = [
            1.0,  1.0,  0.0,
            -1.0,  1.0,  0.0,
            1.0, -1.0,  0.0,
            -1.0, -1.0,  0.0
        ];
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
        squareBuffer.itemSize = 3;
        squareBuffer.numItems = 4;

        atrSetter.aVertexPosition.set(squareBuffer, squareBuffer.itemSize);


        var mv = new THREE.Matrix4();
        mv.makeTranslation(0, 0, -7.0);
        uniformSetter.uMVMatrix.set(mv.elements);

        var proj = new THREE.Matrix4();

        proj.makePerspective(45, 1600 / 900, 0.1, 100.0);

        uniformSetter.uPMatrix.set(proj.elements);

        gl.drawArrays(gl.TRIANGLE_STRIP, 0, squareBuffer.numItems);
    }



</script>
</body>
</html>